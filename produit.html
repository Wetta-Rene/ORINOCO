<!DOCTYPE html>

<html lang="fr">

<head>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="css/styles.css" />
    <script src="js/scripts.js"></script>
    <title>ORINOCO - Produit</title>
</head>

<body>
    <header><img src="images/logoOrinoco.png"></header>
    <nav id="header"></nav>
    <h1 id="baliseH1"></h1>
    <section id="flashMessage">
    </section>
    <section id="resultats">
    </section>
    <script type="text/javascript">
        ////////////////////////////////////////////////////// AFFICHAGE CONTENU DU HEADER ////////////////////////////////////////////////////
        var contenuHeader = fonctionAffichageHeader();
        document.getElementById("header").innerHTML = contenuHeader;
        ///////////////////////////////////////////////////////////  END /////////////////////////////////////////////////////////////////

        ///////////////////////////////////////////////////////////////  MESSAGE PANIER ///////////////////////////////////////////////

        affichageMessageFlash(); // on affiche un message si besoin

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        // quelque variables utiles pour la formation de la page html
        const urlComplete = window.location.href; //recupere l'url
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString); //recupere apres le ? de l'url
        const catalogue = urlParams.get('catalogue'); //recupere catalogue
        const idProduit = urlParams.get('produit'); // recupere produit

        //on fait un switch pour la premiere propriete "colors, lenses, varnish   
        let propertyOne = "";
        switch (catalogue) {
            case "teddies":
                propertyOne = "colors";
                break;
            case "cameras":
                propertyOne = "lenses";
                break;
            case "furniture":
                propertyOne = "varnish";
                break;
        }
        //on verifie que les variables existent
        /*requette XML vers le backend pour la page index.html */

        let xhttp;
        if (catalogue == "") {
            document.getElementById("resultats").innerHTML = "";
        }
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                let response = JSON.parse(this.responseText);
                // on boucle la premiere propriete /

                var options = response[propertyOne]; // propertyOne transmet sa valeur a options

                var selectOptions = "";
                for (let x in options) {
                    selectOptions += '<option value="' + options[x] + '">' + options[x] + '</option>';
                }
                ///////////////////// modification nombre de quantite possible/////////////////
                var selectOptionsQuantite = "";
                for (y = 1; y < 11; y++) {
                    selectOptionsQuantite += '<option value="' + y + '">' + y + '</option>';
                }
                ///////////////////// END  /////////////////

                let article = '<article class="containerArticle"><div class="elementContainerArticle"><img src="' + response.imageUrl + '" ></div><div class="elementContainerArticle"><div class="contentDescriptionArticle"><h2>' + response.name + '</h2><div class="textDescription">' + response.description + '</div><div class="divPrix">Prix: ' + response.price + ' Euro</div><div id="selectOptionProduit"><form methode="GET" action= "gestionPanier.html"><label>Quantité: </label><select name="quantite">' + selectOptionsQuantite + '</select><label> Option: </label><label><select name="option" id="select">' + selectOptions + '</select></label><input type="hidden" name="id" value="' + idProduit + '"><input type="hidden" name="urlRetour" value="' + urlComplete + '"><input type="hidden" name="actionPanier" value="ajout"><input type="hidden" name="name" value="' + response.name + '"><input type="hidden" name="description" value="' + response.description + '"><input type="hidden" name="prix" value="' + response.price + '"><input type="hidden" name="urlImage" value="' + response.imageUrl + '"><input type="hidden" name="catalogue" value="' + catalogue + '"><input type="submit" value="Mettre dans le panier" class="boutonSubmitProduit"/></form></div></div></div></div></article>';
                // affichage des differents article
                let Resultats = document.getElementById("resultats"); //affichage dans id > resultats
                Resultats.innerHTML += article;



            } //fin du if readyState
        };
        xhttp.open("GET", "http://localhost:3000/api/" + catalogue + "/" + idProduit, true);
        xhttp.send();
    </script>
</body>
<footer>
    WETTA René - Avril / Mai 2020 - Projet 5 - Développeur Web by OpenClassrooms.
</footer>

</html>