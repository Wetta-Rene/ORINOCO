<!DOCTYPE html>

<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <link type="text/css" rel="stylesheet" href="css/styles.css" />
        <script src="js/scripts.js"></script>
        <title>ORINOCO - Produit</title>
    </head>

<body>
<header>
    <div id="href"></div>
</header>
    
<script type="text/javascript">
// quelque variables utiles pour la formation de la page html
const urlComplete = window.location.href; //recupere l'url
const queryString = window.location.search; 
const urlParams = new URLSearchParams(queryString); //recupere apres le ? de l'url
const catalogue = urlParams.get('catalogue'); //recupere catalogue
const idProduit = urlParams.get('produit'); // recupere produit

 //on fait un switch pour la premiere propriete "colors, lenses, varnish   
    let propertyOne = "";
switch (catalogue){
    case "teddies":
        propertyOne = "colors";
         break;
        case "cameras":
         propertyOne = "lenses";
         break;
        case "furniture":
         propertyOne = "varnish";
         break;
}
//on verifie que les variables existent
/*requette XML vers le backend pour la page index.html */

    let xhttp;
    if (catalogue == "") {
        document.getElementById("resultats").innerHTML = "";
    }
    xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            let response = JSON.parse(this.responseText);
                    // on boucle la premiere propriete /
                    /*var choix = "";
                    for (let i; i < response.propertyOne.length; i++){
                            choix += response.propertyOne[i];
                            console.log(choix);
                    }*/
                let article = '<article class="containerArticle"><div class="elementContainerArticle"><img src="'+ response.imageUrl +'" ></div><div class="elementContainerArticle"><div class="contentDescriptionArticle"><h2>'+ response.name +'</h2><div class="textDescription">'+ response.description +'</div><div class="divPrix">Prix: '+ response.price +' Euro</div><div id="selectOptionProduit"><form methode="GET" action= "panier.html"><laber>Quantit√©:</label><select name="quantite"><option value="1">1</option><option value="2">2</option></select><select name="option" id="select">article</select><input type="hidden" name="id" value="'+idProduit+'"><input type="hidden" name="urlRetour" value="'+urlComplete+'"><input type="hidden" name="name" value="'+response.name+'"><input type="hidden" name="catalogue" value="'+catalogue+'"><input type="submit" value="Mettre dans le panier" class="boutonSubmit"/></form></div></div></div></div></article>';    
                // affichage des differents article
                let Resultats = document.getElementById("resultats"); //affichage dans id > resultats
                Resultats.innerHTML += article;      

            
            
        }//fin du if readyState
    };
    xhttp.open("GET", "http://localhost:3000/api/"+catalogue+"/"+idProduit, true);
    xhttp.send();

/*
            var xhttp;
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var response = JSON.parse(this.responseText);
                    for (var i = 0; i < response.length; i++) {
                        if (response[i]._id === produit) {
                           var objet = response[i]; //contient tout

                             for (var j = 0; j < objet.colors.length; j++){
                             var choix = '<option value="'+objet.colors[j]+'">'+objet.colors[j]+'</option>';
                             console.log(choix);
                             }


                   var article =   */
</script>

<section id="resultats">

</section>
</body>
<footer>
</footer>
    
</html>